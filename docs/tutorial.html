

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Tutorials &mdash; cs-brix 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Classes" href="classes.html" />
    <link rel="prev" title="Getting started" href="getting_started.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> cs-brix
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#auto-updates-of-geogriddata">Auto-updates of GEOGRIDDATA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-table-from-python">Creating a table from python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-your-module">Testing your module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="classes.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cs-brix</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Tutorials</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorials">
<h1>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h1>
<p>This module also contains a set of other useful functions that integrate with <a class="reference internal" href="classes.html#brix.Handler" title="brix.Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Handler</span></code></a> and <a class="reference internal" href="classes.html#brix.Indicator" title="brix.Indicator"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Indicator</span></code></a>.</p>
<p>The functions <a class="reference internal" href="functions.html#brix.get_OSM_geometries" title="brix.get_OSM_geometries"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.get_OSM_geometries()</span></code></a> and <a class="reference internal" href="functions.html#brix.get_OSM_nodes" title="brix.get_OSM_nodes"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.get_OSM_nodes()</span></code></a> help you get data from Open Street Maps for your table.</p>
<div class="section" id="auto-updates-of-geogriddata">
<h2>Auto-updates of GEOGRIDDATA<a class="headerlink" href="#auto-updates-of-geogriddata" title="Permalink to this headline">¶</a></h2>
<p>Brix also has the capability of automatically updating GEOGRIDDATA. For simple one-time updates, follow the documentation of <a class="reference internal" href="classes.html#brix.Handler.update_geogrid_data" title="brix.Handler.update_geogrid_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Handler.update_geogrid_data()</span></code></a>. To use this feeature, you first need to define a function that takes a <a class="reference internal" href="classes.html#brix.GEOGRIDDATA" title="brix.GEOGRIDDATA"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.GEOGRIDDATA</span></code></a> as an input. When used with <a class="reference internal" href="classes.html#brix.Handler.update_geogrid_data" title="brix.Handler.update_geogrid_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Handler.update_geogrid_data()</span></code></a>, this function can take any number of keyword arguments. The following example raises the height of all cells by 3 units:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_height</span><span class="p">(</span><span class="n">geogrid_data</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">geogrid_data</span><span class="p">:</span>
                <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">levels</span>
        <span class="k">return</span> <span class="n">geogrid_data</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">Handler</span><span class="p">(</span><span class="s1">&#39;dungeonmaster&#39;</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">H</span><span class="o">.</span><span class="n">update_geogrid_data</span><span class="p">(</span><span class="n">add_height</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Brix also supports GEOGRIDDATA updates everytime there is a registered user interaction in the front end. To add a function to the update schedule, use <a class="reference internal" href="classes.html#brix.Handler.add_geogrid_data_update_function" title="brix.Handler.add_geogrid_data_update_function"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Handler.add_geogrid_data_update_function()</span></code></a>. This has the limitation that your update funcion cannot take in any arguments other. If this limitation proves too restrictive, please submit an issue and we’ll consider pushing an update.</p>
<p>The following example updates the whole grid to <cite>Light Industrial</cite> use everytime there’s a user interaction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_g</span><span class="p">(</span><span class="n">geogrid_data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">geogrid_data</span><span class="p">:</span>
                <span class="n">cell</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Light Industrial&#39;</span>
        <span class="k">return</span> <span class="n">geogrid_data</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">Handler</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span><span class="n">quietly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">H</span><span class="o">.</span><span class="n">add_geogrid_data_update_function</span><span class="p">(</span><span class="n">update_g</span><span class="p">)</span>
<span class="n">H</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
</pre></div>
</div>
<p>The updates triggered by <a class="reference internal" href="classes.html#brix.Handler.listen" title="brix.Handler.listen"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Handler.listen()</span></code></a> follow the following order:</p>
<ol class="arabic simple">
<li><p>get GEOGRIDDATA</p></li>
<li><p>run all GEOGRIDDATA updates using the result of 1 as input</p></li>
<li><p>get the new GEOGRIDDATA</p></li>
<li><p>update all indicators using the GEOGRIDDATA object resulting from 3</p></li>
</ol>
</div>
<div class="section" id="creating-a-table-from-python">
<h2>Creating a table from python<a class="headerlink" href="#creating-a-table-from-python" title="Permalink to this headline">¶</a></h2>
<p><cite>Brix</cite> provides a class for creating spatial grids for CityScope projects: <a class="reference internal" href="classes.html#brix.Grid_maker" title="brix.Grid_maker"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Grid_maker</span></code></a> a subclass of <a class="reference internal" href="classes.html#brix.Handler" title="brix.Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Handler</span></code></a>.</p>
<p>For most use cases, you will create your table using the web-app editor found <a class="reference external" href="https://cityscope.media.mit.edu/CS_cityscopeJS/#/editor">here</a>. For more complex projects, you might need to create your own table from an existing dataset. For example, you might want to select the grid area using a polygon defined in a shapefile. The tools we highlight here can be use for this purpose.</p>
<p>The first step is to instantiate the class by defining the location of your table and its name. The lat,lon provided to the <a class="reference internal" href="classes.html#brix.Grid_maker" title="brix.Grid_maker"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Grid_maker</span></code></a> constructor correspond to the top left corner of the grid (North-West).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">brix</span> <span class="kn">import</span> <span class="n">Grid_maker</span>
<span class="n">table_name</span> <span class="o">=</span> <span class="s1">&#39;dungeonmaster&#39;</span>
<span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="mf">42.361875</span><span class="p">,</span> <span class="o">-</span><span class="mf">71.105713</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">Grid_maker</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
</pre></div>
</div>
<p>If the table already exists, you can either use <a class="reference internal" href="classes.html#brix.Handler.delete_table" title="brix.Handler.delete_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Handler.delete_table()</span></code></a> to delete it or wait to be prompted if you want to rewrite it. You can check if the table exists by using <a class="reference internal" href="classes.html#brix.Handler.is_table" title="brix.Handler.is_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Handler.is_table()</span></code></a>. Please note that since <a class="reference internal" href="classes.html#brix.Grid_maker" title="brix.Grid_maker"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Grid_maker</span></code></a> is a subclass of <a class="reference internal" href="classes.html#brix.Handler" title="brix.Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Handler</span></code></a>, most functions available for a <a class="reference internal" href="classes.html#brix.Handler" title="brix.Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Handler</span></code></a> object are also available for a <a class="reference internal" href="classes.html#brix.Grid_maker" title="brix.Grid_maker"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Grid_maker</span></code></a> object. The table constructor also allows you to specify the <cite>cell_size</cite>, the <cite>nrows</cite> and <cite>ncols</cite>, as well as other parameters.</p>
<p>Once the grid maker object has been instatiated, we set the grid by running <a class="reference internal" href="classes.html#brix.Grid_maker.set_grid_geojson" title="brix.Grid_maker.set_grid_geojson"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Grid_maker.set_grid_geojson()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">set_grid_geojson</span><span class="p">()</span>
</pre></div>
</div>
<p>This will create the geojson that will be posted to CityIO to create the table. You can check the object by using <a class="reference internal" href="classes.html#brix.Grid_maker.get_grid_geojson" title="brix.Grid_maker.get_grid_geojson"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Grid_maker.get_grid_geojson()</span></code></a>.</p>
<p>The next step is to define the cell types that the user will be able to choose frorm. Defining the necessary types and the properties of each type is a very complex process that involves data collection and analysis as well as community engagement and simulation that is beyond the scope of this tutorial. The default table created with the Grid constructor only contains a simple type called <cite>Default</cite>. To see this, you can use <a class="reference internal" href="classes.html#brix.Grid_maker.grid_types" title="brix.Grid_maker.grid_types"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Grid_maker.grid_types()</span></code></a>. If you wish to change this, you can use <a class="reference internal" href="classes.html#brix.Grid_maker.edit_types" title="brix.Grid_maker.edit_types"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Grid_maker.edit_types()</span></code></a>. This function will either take a json-like object (dict of dicts) with the name of the type as the key, or a list of names of types that will be automatically completed with default values. Once the types have been defined, they can be expressed in the following way, adding as many properties as needed by your table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="s1">&#39;Default&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;interactive&#39;</span><span class="p">:</span> <span class="s1">&#39;Web&#39;</span><span class="p">,</span>
                <span class="o">...</span>
        <span class="p">},</span>
        <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The bare minimum properties that need to be defined are <cite>color</cite>, <cite>height</cite>, and <cite>interactive</cite>. If not provided, <cite>brix</cite> will assign them automatically.</p>
<p>The following line of code replaces the <cite>Default</cite> type by there other cell types callsed <cite>Type 1</cite>, <cite>Type 2</cite>, and <cite>Type 3</cite>, letting brix assign the color to each of them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">edit_types</span><span class="p">([</span><span class="s1">&#39;Type 1&#39;</span><span class="p">,</span><span class="s1">&#39;Type 2&#39;</span><span class="p">,</span><span class="s1">&#39;Type 3&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>For most applications, you will want to turn off some of the cells and make them non-interactive. Usually, this will involve a shapefile or a geojson that contains the polygon that defines the interactive part of the table. If you have a Shapely polygon stored in <cite>poly</cite> you can set the non-interactive cells by using <a class="reference internal" href="classes.html#brix.Grid_maker.set_noninteractive" title="brix.Grid_maker.set_noninteractive"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Grid_maker.set_noninteractive()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">set_noninteractive</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
</pre></div>
</div>
<p>The final step is to commit the grid to CityIO. Use <a class="reference internal" href="classes.html#brix.Grid_maker.commit_grid" title="brix.Grid_maker.commit_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">brix.Grid_maker.commit_grid()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">commit_grid</span><span class="p">()</span>
</pre></div>
</div>
<p>Putting it all together:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">brix</span> <span class="kn">import</span> <span class="n">Grid_maker</span>
<span class="n">table_name</span> <span class="o">=</span> <span class="s1">&#39;dungeonmaster&#39;</span>
<span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="mf">42.361875</span><span class="p">,</span> <span class="o">-</span><span class="mf">71.105713</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">Grid_maker</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">set_grid_geojson</span><span class="p">()</span>
<span class="n">G</span><span class="o">.</span><span class="n">edit_types</span><span class="p">([</span><span class="s1">&#39;Type 1&#39;</span><span class="p">,</span><span class="s1">&#39;Type 2&#39;</span><span class="p">,</span><span class="s1">&#39;Type 3&#39;</span><span class="p">])</span>
<span class="n">G</span><span class="o">.</span><span class="n">set_noninteractive</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">commit_grid</span><span class="p">()</span>
</pre></div>
</div>
<p>Alternatively, you can use <cite>poly</cite> as an argument to <code class="xref py py-func docutils literal notranslate"><span class="pre">brix.grid_from_poly()</span></code>. This function will calculate the location and the cell size based on the given polygon, and set the non-interactive parts. The following block of code achieves the same as the block above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">brix</span> <span class="kn">import</span> <span class="n">Grid_maker</span><span class="p">,</span> <span class="n">grid_from_poly</span>
<span class="n">table_name</span> <span class="o">=</span> <span class="s1">&#39;dungeonmaster&#39;</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">grid_from_poly</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">poly</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">edit_types</span><span class="p">([</span><span class="s1">&#39;Type 1&#39;</span><span class="p">,</span><span class="s1">&#39;Type 2&#39;</span><span class="p">,</span><span class="s1">&#39;Type 3&#39;</span><span class="p">])</span>
<span class="n">G</span><span class="o">.</span><span class="n">commit_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-your-module">
<h2>Testing your module<a class="headerlink" href="#testing-your-module" title="Permalink to this headline">¶</a></h2>
<p>To automatically test your module, this library provides the <a class="reference internal" href="classes.html#brix.User" title="brix.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.User</span></code></a> class that simulates the behavior of a user interacting with your grid. This user runs in its own new thread to free up your main thread so that you can keep wokring on your indicator.</p>
<p>The following example consists of a <a class="reference internal" href="classes.html#brix.Handler" title="brix.Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Handler</span></code></a> that contains a diversity <a class="reference internal" href="classes.html#brix.Indicator" title="brix.Indicator"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.Indicator</span></code></a> that reponds to the updates of the <a class="reference internal" href="classes.html#brix.User" title="brix.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">brix.User</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">brix</span> <span class="kn">import</span> <span class="n">Handler</span>
<span class="kn">from</span> <span class="nn">brix.examples</span> <span class="kn">import</span> <span class="n">Diversity</span>
<span class="kn">from</span> <span class="nn">brix.test_tools</span> <span class="kn">import</span> <span class="n">User</span>
<span class="n">table_name</span> <span class="o">=</span> <span class="s1">&#39;dungeonmaster&#39;</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">Handler</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span><span class="n">quietly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">div</span> <span class="o">=</span> <span class="n">Diversity</span><span class="p">()</span>
<span class="n">H</span><span class="o">.</span><span class="n">add_indicator</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
<span class="n">U</span><span class="o">.</span><span class="n">start_user</span><span class="p">()</span>
<span class="n">H</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="classes.html" class="btn btn-neutral float-right" title="Classes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="getting_started.html" class="btn btn-neutral float-left" title="Getting started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, CityScience group at the MIT Media Lab.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>